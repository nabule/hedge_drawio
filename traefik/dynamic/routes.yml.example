http:
  # ==========================================
  # 1. 定义中间件 (Middlewares)
  # ==========================================
  middlewares:
    # 定义安全头中间件
    secure-headers:
      headers:
        # 强制重定向到 HTTPS
        sslRedirect: true
        # 开启 HSTS (告诉浏览器未来一年只通过 HTTPS 访问)
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true
        # 手动添加协议头，告知后端使用 HTTPS
        customRequestHeaders:
          X-Forwarded-Proto: "https"
    
    # --- Basic 认证中间件（可选）---
    my-auth:
      basicAuth:
        # 格式: "用户名:哈希密码"
        # 使用 htpasswd 生成: htpasswd -nb admin yourpassword
        users:
          # 请替换为你生成的字符串
          - "admin:<YOUR_HASHED_PASSWORD>"

  # ==========================================
  # 2. 路由配置 (Routers)
  # ==========================================
  routers:
    # === HedgeDoc 路由 ===
    hedgedoc:
      rule: "Host(`md.<YOUR_DOMAIN>`)"
      entryPoints:
        - web
      service: hedgedoc
      tls: {}
      # 挂载安全头中间件
      middlewares:
        - "secure-headers"
        

    # === DrawIO 路由 ===
    drawio:
      rule: "Host(`drawio.<YOUR_DOMAIN>`)"
      entryPoints:
        - web
      service: drawio
      tls: {}
      # DrawIO 也加上安全头中间件
      middlewares:
        - "secure-headers"

  # ==========================================
  # 3. 服务配置 (Services)
  # ==========================================
  services:
    # HedgeDoc 服务
    hedgedoc:
      loadBalancer:
        servers:
          - url: "http://hedgedoc:3000"

    # DrawIO 服务
    drawio:
      loadBalancer:
        servers:
          - url: "http://drawio:8080"
